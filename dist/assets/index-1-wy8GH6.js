var $=Object.defineProperty;var V=(n,t,e)=>t in n?$(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var l=(n,t,e)=>V(n,typeof t!="symbol"?t+"":t,e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function e(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(s){if(s.ep)return;s.ep=!0;const r=e(s);fetch(s.href,r)}})();var F=function(n,t){return F=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(e[s]=i[s])},F(n,t)};function v(n,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");F(n,t);function e(){this.constructor=n}n.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}function S(n){var t=typeof Symbol=="function"&&Symbol.iterator,e=t&&n[t],i=0;if(e)return e.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&i>=n.length&&(n=void 0),{value:n&&n[i++],done:!n}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function R(n,t){var e=typeof Symbol=="function"&&n[Symbol.iterator];if(!e)return n;var i=e.call(n),s,r=[],o;try{for(;(t===void 0||t-- >0)&&!(s=i.next()).done;)r.push(s.value)}catch(a){o={error:a}}finally{try{s&&!s.done&&(e=i.return)&&e.call(i)}finally{if(o)throw o.error}}return r}function O(n,t,e){if(e||arguments.length===2)for(var i=0,s=t.length,r;i<s;i++)(r||!(i in t))&&(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return n.concat(r||Array.prototype.slice.call(t))}function m(n){return typeof n=="function"}function X(n){var t=function(i){Error.call(i),i.stack=new Error().stack},e=n(t);return e.prototype=Object.create(Error.prototype),e.prototype.constructor=e,e}var N=X(function(n){return function(e){n(this),this.message=e?e.length+` errors occurred during unsubscription:
`+e.map(function(i,s){return s+1+") "+i.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=e}});function G(n,t){if(n){var e=n.indexOf(t);0<=e&&n.splice(e,1)}}var x=function(){function n(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._finalizers=null}return n.prototype.unsubscribe=function(){var t,e,i,s,r;if(!this.closed){this.closed=!0;var o=this._parentage;if(o)if(this._parentage=null,Array.isArray(o))try{for(var a=S(o),h=a.next();!h.done;h=a.next()){var u=h.value;u.remove(this)}}catch(p){t={error:p}}finally{try{h&&!h.done&&(e=a.return)&&e.call(a)}finally{if(t)throw t.error}}else o.remove(this);var d=this.initialTeardown;if(m(d))try{d()}catch(p){r=p instanceof N?p.errors:[p]}var g=this._finalizers;if(g){this._finalizers=null;try{for(var y=S(g),_=y.next();!_.done;_=y.next()){var C=_.value;try{B(C)}catch(p){r=r??[],p instanceof N?r=O(O([],R(r)),R(p.errors)):r.push(p)}}}catch(p){i={error:p}}finally{try{_&&!_.done&&(s=y.return)&&s.call(y)}finally{if(i)throw i.error}}}if(r)throw new N(r)}},n.prototype.add=function(t){var e;if(t&&t!==this)if(this.closed)B(t);else{if(t instanceof n){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=(e=this._finalizers)!==null&&e!==void 0?e:[]).push(t)}},n.prototype._hasParent=function(t){var e=this._parentage;return e===t||Array.isArray(e)&&e.includes(t)},n.prototype._addParent=function(t){var e=this._parentage;this._parentage=Array.isArray(e)?(e.push(t),e):e?[e,t]:t},n.prototype._removeParent=function(t){var e=this._parentage;e===t?this._parentage=null:Array.isArray(e)&&G(e,t)},n.prototype.remove=function(t){var e=this._finalizers;e&&G(e,t),t instanceof n&&t._removeParent(this)},n.EMPTY=function(){var t=new n;return t.closed=!0,t}(),n}(),K=x.EMPTY;function Y(n){return n instanceof x||n&&"closed"in n&&m(n.remove)&&m(n.add)&&m(n.unsubscribe)}function B(n){m(n)?n():n.unsubscribe()}var Z={Promise:void 0},J={setTimeout:function(n,t){for(var e=[],i=2;i<arguments.length;i++)e[i-2]=arguments[i];return setTimeout.apply(void 0,O([n,t],R(e)))},clearTimeout:function(n){return clearTimeout(n)},delegate:void 0};function Q(n){J.setTimeout(function(){throw n})}function L(){}function T(n){n()}var H=function(n){v(t,n);function t(e){var i=n.call(this)||this;return i.isStopped=!1,e?(i.destination=e,Y(e)&&e.add(i)):i.destination=it,i}return t.create=function(e,i,s){return new z(e,i,s)},t.prototype.next=function(e){this.isStopped||this._next(e)},t.prototype.error=function(e){this.isStopped||(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,n.prototype.unsubscribe.call(this),this.destination=null)},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){try{this.destination.error(e)}finally{this.unsubscribe()}},t.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},t}(x),tt=function(){function n(t){this.partialObserver=t}return n.prototype.next=function(t){var e=this.partialObserver;if(e.next)try{e.next(t)}catch(i){P(i)}},n.prototype.error=function(t){var e=this.partialObserver;if(e.error)try{e.error(t)}catch(i){P(i)}else P(t)},n.prototype.complete=function(){var t=this.partialObserver;if(t.complete)try{t.complete()}catch(e){P(e)}},n}(),z=function(n){v(t,n);function t(e,i,s){var r=n.call(this)||this,o;return m(e)||!e?o={next:e??void 0,error:i??void 0,complete:s??void 0}:o=e,r.destination=new tt(o),r}return t}(H);function P(n){Q(n)}function et(n){throw n}var it={closed:!0,next:L,error:et,complete:L},nt=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function st(n){return n}function rt(n){return n.length===0?st:n.length===1?n[0]:function(e){return n.reduce(function(i,s){return s(i)},e)}}var U=function(){function n(t){t&&(this._subscribe=t)}return n.prototype.lift=function(t){var e=new n;return e.source=this,e.operator=t,e},n.prototype.subscribe=function(t,e,i){var s=this,r=at(t)?t:new z(t,e,i);return T(function(){var o=s,a=o.operator,h=o.source;r.add(a?a.call(r,h):h?s._subscribe(r):s._trySubscribe(r))}),r},n.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(e){t.error(e)}},n.prototype.forEach=function(t,e){var i=this;return e=k(e),new e(function(s,r){var o=new z({next:function(a){try{t(a)}catch(h){r(h),o.unsubscribe()}},error:r,complete:s});i.subscribe(o)})},n.prototype._subscribe=function(t){var e;return(e=this.source)===null||e===void 0?void 0:e.subscribe(t)},n.prototype[nt]=function(){return this},n.prototype.pipe=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return rt(t)(this)},n.prototype.toPromise=function(t){var e=this;return t=k(t),new t(function(i,s){var r;e.subscribe(function(o){return r=o},function(o){return s(o)},function(){return i(r)})})},n.create=function(t){return new n(t)},n}();function k(n){var t;return(t=n??Z.Promise)!==null&&t!==void 0?t:Promise}function ot(n){return n&&m(n.next)&&m(n.error)&&m(n.complete)}function at(n){return n&&n instanceof H||ot(n)&&Y(n)}function ct(n){return m(n==null?void 0:n.lift)}function lt(n){return function(t){if(ct(t))return t.lift(function(e){try{return n(e,this)}catch(i){this.error(i)}});throw new TypeError("Unable to lift unknown Observable type")}}function ht(n,t,e,i,s){return new ut(n,t,e,i,s)}var ut=function(n){v(t,n);function t(e,i,s,r,o,a){var h=n.call(this,e)||this;return h.onFinalize=o,h.shouldUnsubscribe=a,h._next=i?function(u){try{i(u)}catch(d){e.error(d)}}:n.prototype._next,h._error=r?function(u){try{r(u)}catch(d){e.error(d)}finally{this.unsubscribe()}}:n.prototype._error,h._complete=s?function(){try{s()}catch(u){e.error(u)}finally{this.unsubscribe()}}:n.prototype._complete,h}return t.prototype.unsubscribe=function(){var e;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var i=this.closed;n.prototype.unsubscribe.call(this),!i&&((e=this.onFinalize)===null||e===void 0||e.call(this))}},t}(H),dt=X(function(n){return function(){n(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),A=function(n){v(t,n);function t(){var e=n.call(this)||this;return e.closed=!1,e.currentObservers=null,e.observers=[],e.isStopped=!1,e.hasError=!1,e.thrownError=null,e}return t.prototype.lift=function(e){var i=new j(this,this);return i.operator=e,i},t.prototype._throwIfClosed=function(){if(this.closed)throw new dt},t.prototype.next=function(e){var i=this;T(function(){var s,r;if(i._throwIfClosed(),!i.isStopped){i.currentObservers||(i.currentObservers=Array.from(i.observers));try{for(var o=S(i.currentObservers),a=o.next();!a.done;a=o.next()){var h=a.value;h.next(e)}}catch(u){s={error:u}}finally{try{a&&!a.done&&(r=o.return)&&r.call(o)}finally{if(s)throw s.error}}}})},t.prototype.error=function(e){var i=this;T(function(){if(i._throwIfClosed(),!i.isStopped){i.hasError=i.isStopped=!0,i.thrownError=e;for(var s=i.observers;s.length;)s.shift().error(e)}})},t.prototype.complete=function(){var e=this;T(function(){if(e._throwIfClosed(),!e.isStopped){e.isStopped=!0;for(var i=e.observers;i.length;)i.shift().complete()}})},t.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(t.prototype,"observed",{get:function(){var e;return((e=this.observers)===null||e===void 0?void 0:e.length)>0},enumerable:!1,configurable:!0}),t.prototype._trySubscribe=function(e){return this._throwIfClosed(),n.prototype._trySubscribe.call(this,e)},t.prototype._subscribe=function(e){return this._throwIfClosed(),this._checkFinalizedStatuses(e),this._innerSubscribe(e)},t.prototype._innerSubscribe=function(e){var i=this,s=this,r=s.hasError,o=s.isStopped,a=s.observers;return r||o?K:(this.currentObservers=null,a.push(e),new x(function(){i.currentObservers=null,G(a,e)}))},t.prototype._checkFinalizedStatuses=function(e){var i=this,s=i.hasError,r=i.thrownError,o=i.isStopped;s?e.error(r):o&&e.complete()},t.prototype.asObservable=function(){var e=new U;return e.source=this,e},t.create=function(e,i){return new j(e,i)},t}(U),j=function(n){v(t,n);function t(e,i){var s=n.call(this)||this;return s.destination=e,s.source=i,s}return t.prototype.next=function(e){var i,s;(s=(i=this.destination)===null||i===void 0?void 0:i.next)===null||s===void 0||s.call(i,e)},t.prototype.error=function(e){var i,s;(s=(i=this.destination)===null||i===void 0?void 0:i.error)===null||s===void 0||s.call(i,e)},t.prototype.complete=function(){var e,i;(i=(e=this.destination)===null||e===void 0?void 0:e.complete)===null||i===void 0||i.call(e)},t.prototype._subscribe=function(e){var i,s;return(s=(i=this.source)===null||i===void 0?void 0:i.subscribe(e))!==null&&s!==void 0?s:K},t}(A),ft=function(n){v(t,n);function t(e){var i=n.call(this)||this;return i._value=e,i}return Object.defineProperty(t.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),t.prototype._subscribe=function(e){var i=n.prototype._subscribe.call(this,e);return!i.closed&&e.next(this._value),i},t.prototype.getValue=function(){var e=this,i=e.hasError,s=e.thrownError,r=e._value;if(i)throw s;return this._throwIfClosed(),r},t.prototype.next=function(e){n.prototype.next.call(this,this._value=e)},t}(A);function pt(n,t){return lt(function(e,i){var s=0;e.subscribe(ht(i,function(r){i.next(n.call(t,r,s++))}))})}var c=(n=>(n[n.WRIST=0]="WRIST",n[n.THUMB_CMC=1]="THUMB_CMC",n[n.THUMB_MCP=2]="THUMB_MCP",n[n.THUMB_IP=3]="THUMB_IP",n[n.THUMB_TIP=4]="THUMB_TIP",n[n.INDEX_FINGER_MCP=5]="INDEX_FINGER_MCP",n[n.INDEX_FINGER_PIP=6]="INDEX_FINGER_PIP",n[n.INDEX_FINGER_DIP=7]="INDEX_FINGER_DIP",n[n.INDEX_FINGER_TIP=8]="INDEX_FINGER_TIP",n[n.MIDDLE_FINGER_MCP=9]="MIDDLE_FINGER_MCP",n[n.MIDDLE_FINGER_PIP=10]="MIDDLE_FINGER_PIP",n[n.MIDDLE_FINGER_DIP=11]="MIDDLE_FINGER_DIP",n[n.MIDDLE_FINGER_TIP=12]="MIDDLE_FINGER_TIP",n[n.RING_FINGER_MCP=13]="RING_FINGER_MCP",n[n.RING_FINGER_PIP=14]="RING_FINGER_PIP",n[n.RING_FINGER_DIP=15]="RING_FINGER_DIP",n[n.RING_FINGER_TIP=16]="RING_FINGER_TIP",n[n.PINKY_MCP=17]="PINKY_MCP",n[n.PINKY_PIP=18]="PINKY_PIP",n[n.PINKY_DIP=19]="PINKY_DIP",n[n.PINKY_TIP=20]="PINKY_TIP",n))(c||{});const mt=[[0,1],[1,2],[2,3],[3,4],[0,5],[5,6],[6,7],[7,8],[0,9],[9,10],[10,11],[11,12],[0,13],[13,14],[14,15],[15,16],[0,17],[17,18],[18,19],[19,20],[5,9],[9,13],[13,17]];var f=(n=>(n.NONE="none",n.OPEN_HAND="open_hand",n.CLOSED_FIST="closed_fist",n.POINTING="pointing",n.THUMBS_UP="thumbs_up",n.PEACE="peace",n.PINCH="pinch",n))(f||{});function gt(n){return{handId:n,isTracked:!1,position:{x:0,y:0},fingertipPosition:{x:0,y:0},velocity:{vx:0,vy:0,magnitude:0},gesture:{type:"none",confidence:0,duration:0},fingers:{thumb:!1,index:!1,middle:!1,ring:!1,pinky:!1,extendedCount:0},openness:{value:0,derivative:0},depth:0,rotation:0}}function M(){return{timestamp:Date.now(),deltaTime:0,hands:[],hasActiveHand:!1,primaryHand:null,secondaryHand:null,custom:{}}}const b=21,E={wrist:"#ffd93d",thumb:"#ff6b6b",index:"#4ecdc4",middle:"#45b7d1",ring:"#96ceb4",pinky:"#dda0dd"},yt="rgba(255, 255, 255, 0.6)",_t=5,Et=2,vt={maxHands:2,minDetectionConfidence:.7,minTrackingConfidence:.5,targetFps:30,smoothing:!0,smoothingFactor:.3};function It(n,t,e){return{x:t.x+(n.x-t.x)*e,y:t.y+(n.y-t.y)*e,z:t.z+(n.z-t.z)*e}}class bt{constructor(t=.3,e=5){l(this,"buffer",new Map);l(this,"factor");l(this,"bufferSize");this.factor=Math.max(0,Math.min(1,t)),this.bufferSize=e}smoothLandmark(t,e,i){const s=t*b+e;let r=this.buffer.get(s);if(!r||r.length===0)return r=[i],this.buffer.set(s,r),i;const o=r[r.length-1],a=It(i,o,this.factor);return r.push(a),r.length>this.bufferSize&&r.shift(),a}smoothLandmarks(t,e){const i=[];for(let s=0;s<b;s++)i.push(this.smoothLandmark(t,s,e[s]));return i}clearHand(t){for(let e=0;e<b;e++){const i=t*b+e;this.buffer.delete(i)}}clear(){this.buffer.clear()}get smoothingFactor(){return this.factor}}const W="https://cdn.jsdelivr.net/npm/@mediapipe/hands",Pt=`${W}/hands.js`;let I=null,D=!1;async function Tt(n){return D&&window.Hands?window.Hands:I||(I=new Promise((t,e)=>{if(n==null||n("Loading MediaPipe Hands...",0),window.Hands){D=!0,n==null||n("MediaPipe Hands ready",100),t(window.Hands);return}const i=document.createElement("script");i.src=Pt,i.crossOrigin="anonymous",i.onload=()=>{n==null||n("Initializing MediaPipe...",50),setTimeout(()=>{window.Hands?(D=!0,n==null||n("MediaPipe Hands ready",100),t(window.Hands)):e(new Error("MediaPipe Hands failed to initialize"))},100)},i.onerror=()=>{I=null,e(new Error("Failed to load MediaPipe Hands from CDN"))},n==null||n("Downloading MediaPipe...",10),document.head.appendChild(i)}),I)}function xt(){return n=>`${W}/${n}`}class wt{constructor(t={}){l(this,"config");l(this,"hands",null);l(this,"videoElement",null);l(this,"subject",new A);l(this,"smoother");l(this,"animationFrameId",null);l(this,"_isTracking",!1);l(this,"initialized",!1);l(this,"lastTimestamp",0);this.config={...vt,...t},this.smoother=new bt(this.config.smoothingFactor,5)}get hands$(){return this.subject.asObservable()}get isTracking(){return this._isTracking}async initialize(t,e){if(this.initialized)throw new Error("HandTracker is already initialized. Call dispose() first.");this.videoElement=t,e==null||e("Loading hand tracking model...",0);const i=await Tt(e);this.hands=new i({locateFile:xt()}),this.hands.setOptions({maxNumHands:this.config.maxHands,minDetectionConfidence:this.config.minDetectionConfidence,minTrackingConfidence:this.config.minTrackingConfidence,modelComplexity:1}),this.hands.onResults(s=>{this.processResults(s)}),e==null||e("Hand tracking ready",100),this.initialized=!0}start(){if(!this.initialized){console.warn("HandTracker not initialized. Call initialize() first.");return}this._isTracking||(this._isTracking=!0,this.lastTimestamp=performance.now(),this.requestFrame())}stop(){this._isTracking=!1,this.animationFrameId!==null&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null)}dispose(){this.stop(),this.hands&&(this.hands.close(),this.hands=null),this.smoother.clear(),this.subject.complete(),this.videoElement=null,this.initialized=!1}requestFrame(){this._isTracking&&(this.animationFrameId=requestAnimationFrame(()=>{this.processFrame()}))}async processFrame(){if(!this._isTracking||!this.hands||!this.videoElement)return;const t=performance.now(),e=1e3/this.config.targetFps;if(t-this.lastTimestamp<e){this.requestFrame();return}this.lastTimestamp=t;try{await this.hands.send({image:this.videoElement})}catch(i){console.error("Error processing frame:",i)}this.requestFrame()}processResults(t){const e=performance.now(),i=[];if(t.multiHandLandmarks&&t.multiHandedness)for(let o=0;o<t.multiHandLandmarks.length;o++){const a=t.multiHandLandmarks[o],h=t.multiHandedness[o];if(a&&h){let u=this.convertLandmarks(a);this.config.smoothing&&(u=this.smoother.smoothLandmarks(o,u)),i.push({id:o,handedness:h.label,landmarks:u,confidence:h.score??.9})}}const s=performance.now()-e,r={hands:i,handCount:i.length,timestamp:Date.now(),processingTime:s};this.subject.next(r)}convertLandmarks(t){const e=[];for(let i=0;i<b;i++){const s=t[i];s?e.push({x:s.x,y:s.y,z:s.z}):e.push({x:0,y:0,z:0})}return e}}const Ct={width:640,height:480,facingMode:"user"};class Nt{constructor(t={}){l(this,"videoElement",null);l(this,"stream",null);l(this,"config");this.config={...Ct,...t}}async initialize(t){this.videoElement=t;try{this.stream=await navigator.mediaDevices.getUserMedia({video:{width:{ideal:this.config.width},height:{ideal:this.config.height},facingMode:this.config.facingMode},audio:!1}),this.videoElement.srcObject=this.stream,await new Promise((e,i)=>{if(!this.videoElement){i(new Error("Video element not available"));return}this.videoElement.onloadedmetadata=()=>{e()},this.videoElement.onerror=()=>{i(new Error("Failed to load video"))}}),await this.videoElement.play()}catch(e){const i=this.getErrorMessage(e);throw new Error(`Camera initialization failed: ${i}`)}}async checkPermission(){try{return(await navigator.permissions.query({name:"camera"})).state}catch{return"prompt"}}getVideoElement(){return this.videoElement}getDimensions(){return this.videoElement?{width:this.videoElement.videoWidth||this.config.width,height:this.videoElement.videoHeight||this.config.height}:{width:this.config.width,height:this.config.height}}stop(){this.stream&&(this.stream.getTracks().forEach(t=>t.stop()),this.stream=null),this.videoElement&&(this.videoElement.srcObject=null)}dispose(){this.stop(),this.videoElement=null}getErrorMessage(t){if(t instanceof DOMException)switch(t.name){case"NotAllowedError":return"Camera access was denied. Please grant permission to use the camera.";case"NotFoundError":return"No camera found. Please connect a camera and try again.";case"NotReadableError":return"Camera is in use by another application.";case"OverconstrainedError":return"Camera does not meet the required constraints.";default:return t.message}return t instanceof Error?t.message:"Unknown error occurred"}}const Mt={showLandmarks:!0,showConnections:!0,showFps:!0,landmarkRadius:_t,connectionWidth:Et};class Dt{constructor(){l(this,"frames",[]);l(this,"windowSize",30)}tick(){const t=performance.now();for(this.frames.push(t);this.frames.length>this.windowSize;)this.frames.shift()}getFps(){if(this.frames.length<2)return 0;const t=this.frames[0],i=this.frames[this.frames.length-1]-t;return i===0?0:Math.round((this.frames.length-1)/i*1e3)}reset(){this.frames=[]}}class Ft{constructor(t={}){l(this,"canvas",null);l(this,"ctx",null);l(this,"config");l(this,"fpsCalculator",new Dt);l(this,"fpsElement",null);this.config={...Mt,...t}}initialize(t,e){this.canvas=t,this.ctx=t.getContext("2d",{willReadFrequently:!1}),this.fpsElement=e??null}setDimensions(t,e){this.canvas&&(this.canvas.width=t,this.canvas.height=e)}draw(t){if(!(!this.ctx||!this.canvas)){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.fpsCalculator.tick(),this.updateFpsDisplay();for(const e of t.hands)this.drawHand(e)}}clear(){!this.ctx||!this.canvas||this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)}dispose(){this.clear(),this.fpsCalculator.reset(),this.canvas=null,this.ctx=null,this.fpsElement=null}drawHand(t){if(!this.ctx||!this.canvas)return;const{landmarks:e}=t,i=this.canvas.width,s=this.canvas.height;this.config.showConnections&&this.drawConnections(e,i,s),this.config.showLandmarks&&this.drawLandmarks(e,i,s)}drawConnections(t,e,i){if(this.ctx){this.ctx.strokeStyle=yt,this.ctx.lineWidth=this.config.connectionWidth,this.ctx.lineCap="round";for(const[s,r]of mt){const o=t[s],a=t[r];!o||!a||(this.ctx.beginPath(),this.ctx.moveTo(o.x*e,o.y*i),this.ctx.lineTo(a.x*e,a.y*i),this.ctx.stroke())}}}drawLandmarks(t,e,i){if(this.ctx)for(let s=0;s<t.length;s++){const r=t[s];if(!r)continue;const o=r.x*e,a=r.y*i,h=this.getLandmarkColor(s);this.ctx.beginPath(),this.ctx.arc(o,a,this.config.landmarkRadius,0,Math.PI*2),this.ctx.fillStyle=h,this.ctx.fill(),this.ctx.strokeStyle="rgba(0, 0, 0, 0.5)",this.ctx.lineWidth=1,this.ctx.stroke()}}getLandmarkColor(t){const e=c.WRIST,i=c.THUMB_TIP,s=c.INDEX_FINGER_TIP,r=c.MIDDLE_FINGER_TIP,o=c.RING_FINGER_TIP;return t===e?E.wrist:t<=i?E.thumb:t<=s?E.index:t<=r?E.middle:t<=o?E.ring:E.pinky}updateFpsDisplay(){if(!this.config.showFps||!this.fpsElement)return;const t=this.fpsCalculator.getFps();this.fpsElement.textContent=`FPS: ${t}`}}const w={position:{smoothingEnabled:!0,smoothingFactor:.3,trackingMode:"palm",calculateVelocity:!0,movementThreshold:.005},gesture:{smoothingEnabled:!0,smoothingFactor:.2,minConfidence:.7,minDuration:100,pinchThreshold:.08,extensionAngleThreshold:2.5},distance:{smoothingEnabled:!0,smoothingFactor:.3,normalizeToHandSize:!0}};class St{constructor(t){l(this,"name","PositionController");l(this,"_config");l(this,"handHistory",new Map);this._config={...w.position,...t}}get config(){return{...this._config}}updateConfig(t){this._config={...this._config,...t}}reset(){this.handHistory.clear()}process(t,e){const i=t.hands.map(r=>this.processHand(r,t.timestamp,e)),s=new Set(t.hands.map(r=>r.id));for(const[r]of this.handHistory)s.has(r)||this.handHistory.delete(r);return{...e,hands:i,hasActiveHand:i.length>0,primaryHand:i[0]||null,secondaryHand:i[1]||null}}processHand(t,e,i){const r=i.hands.find(C=>C.handId===t.id)??gt(t.id),o=this.calculatePosition(t.landmarks),a=this.getLandmarkPosition(t.landmarks,c.INDEX_FINGER_TIP);let h=this.handHistory.get(t.id);h||(h={lastPosition:null,lastTimestamp:e,smoothedPosition:o},this.handHistory.set(t.id,h));const u=this._config.smoothingEnabled?this.smoothPosition(o,h.smoothedPosition):o,d=this.applyThreshold(u,h.smoothedPosition),g=this._config.calculateVelocity?this.calculateVelocity(d,h.lastPosition,e,h.lastTimestamp):r.velocity;h.lastPosition=d,h.lastTimestamp=e,h.smoothedPosition=d;const y=this.calculateDepth(t.landmarks),_=this.calculateRotation(t.landmarks);return{...r,isTracked:!0,position:d,fingertipPosition:a,velocity:g,depth:y,rotation:_}}calculatePosition(t){switch(this._config.trackingMode){case"index_tip":return this.getLandmarkPosition(t,c.INDEX_FINGER_TIP);case"wrist":return this.getLandmarkPosition(t,c.WRIST);case"palm":default:return this.calculatePalmCenter(t)}}calculatePalmCenter(t){const e=[t[c.WRIST],t[c.INDEX_FINGER_MCP],t[c.MIDDLE_FINGER_MCP],t[c.RING_FINGER_MCP],t[c.PINKY_MCP]],i=e.reduce((s,r)=>({x:s.x+r.x,y:s.y+r.y}),{x:0,y:0});return{x:i.x/e.length,y:i.y/e.length}}getLandmarkPosition(t,e){const i=t[e];return{x:i.x,y:i.y}}smoothPosition(t,e){const i=1-this._config.smoothingFactor;return{x:i*t.x+this._config.smoothingFactor*e.x,y:i*t.y+this._config.smoothingFactor*e.y}}applyThreshold(t,e){const i=t.x-e.x,s=t.y-e.y;return Math.sqrt(i*i+s*s)<this._config.movementThreshold?e:t}calculateVelocity(t,e,i,s){if(!e||i===s)return{vx:0,vy:0,magnitude:0};const r=(i-s)/1e3;if(r<=0)return{vx:0,vy:0,magnitude:0};const o=(t.x-e.x)/r,a=(t.y-e.y)/r,h=Math.sqrt(o*o+a*a);return{vx:o,vy:a,magnitude:h}}calculateDepth(t){const e=t.reduce((i,s)=>i+s.z,0)/t.length;return Math.max(0,Math.min(1,.5-e))}calculateRotation(t){const e=t[c.WRIST],i=t[c.MIDDLE_FINGER_MCP],s=i.x-e.x,r=i.y-e.y;return Math.atan2(r,s)}}class Rt{constructor(t){l(this,"name","GestureController");l(this,"_config");l(this,"gestureHistory",new Map);this._config={...w.gesture,...t}}get config(){return{...this._config}}updateConfig(t){this._config={...this._config,...t}}reset(){this.gestureHistory.clear()}process(t,e){const i=e.hands.map(r=>{const o=t.hands.find(a=>a.id===r.handId);return o?this.processHand(o,t.timestamp,r):r}),s=new Set(t.hands.map(r=>r.id));for(const[r]of this.gestureHistory)s.has(r)||this.gestureHistory.delete(r);return{...e,hands:i,primaryHand:i[0]||null,secondaryHand:i[1]||null}}processHand(t,e,i){const s=this.detectFingerStates(t.landmarks),r=this.calculateOpenness(t.landmarks);let o=this.gestureHistory.get(t.id);o||(o={lastGesture:f.NONE,gestureStartTime:e,smoothedOpenness:r},this.gestureHistory.set(t.id,o));const a=this._config.smoothingEnabled?this.smoothValue(r,o.smoothedOpenness):r,h=(a-o.smoothedOpenness)/Math.max(1,e-o.gestureStartTime);o.smoothedOpenness=a;const u=this.detectGesture(t.landmarks,s,a);u!==o.lastGesture&&(o.lastGesture=u,o.gestureStartTime=e);const d=e-o.gestureStartTime,g={type:d>=this._config.minDuration?u:i.gesture.type,confidence:this.calculateGestureConfidence(u,s,a),duration:u===i.gesture.type?i.gesture.duration+(e-i.gesture.duration):0};return g.duration=d,{...i,gesture:g,fingers:s,openness:{value:a,derivative:h}}}detectFingerStates(t){const e=this.isThumbExtended(t),i=this.isFingerExtended(t,"index"),s=this.isFingerExtended(t,"middle"),r=this.isFingerExtended(t,"ring"),o=this.isFingerExtended(t,"pinky"),a=[e,i,s,r,o].filter(Boolean).length;return{thumb:e,index:i,middle:s,ring:r,pinky:o,extendedCount:a}}isThumbExtended(t){const e=t[c.THUMB_TIP],i=t[c.THUMB_IP],s=t[c.THUMB_MCP],r=t[c.WRIST],o=this.distance3D(e,r),a=this.distance3D(i,r),h=this.distance3D(s,r);return o>a&&o>h*1.2}isFingerExtended(t,e){const s={index:{mcp:c.INDEX_FINGER_MCP,pip:c.INDEX_FINGER_PIP,dip:c.INDEX_FINGER_DIP,tip:c.INDEX_FINGER_TIP},middle:{mcp:c.MIDDLE_FINGER_MCP,pip:c.MIDDLE_FINGER_PIP,dip:c.MIDDLE_FINGER_DIP,tip:c.MIDDLE_FINGER_TIP},ring:{mcp:c.RING_FINGER_MCP,pip:c.RING_FINGER_PIP,dip:c.RING_FINGER_DIP,tip:c.RING_FINGER_TIP},pinky:{mcp:c.PINKY_MCP,pip:c.PINKY_PIP,dip:c.PINKY_DIP,tip:c.PINKY_TIP}}[e],r=t[s.mcp],o=t[s.pip],a=t[s.dip],h=t[s.tip],u=this.calculateAngle(r,o,a),d=this.calculateAngle(o,a,h);return u>this._config.extensionAngleThreshold&&d>this._config.extensionAngleThreshold}calculateAngle(t,e,i){const s={x:t.x-e.x,y:t.y-e.y,z:t.z-e.z},r={x:i.x-e.x,y:i.y-e.y,z:i.z-e.z},o=s.x*r.x+s.y*r.y+s.z*r.z,a=Math.sqrt(s.x*s.x+s.y*s.y+s.z*s.z),h=Math.sqrt(r.x*r.x+r.y*r.y+r.z*r.z);if(a===0||h===0)return 0;const u=Math.max(-1,Math.min(1,o/(a*h)));return Math.acos(u)}distance3D(t,e){const i=t.x-e.x,s=t.y-e.y,r=t.z-e.z;return Math.sqrt(i*i+s*s+r*r)}distance2D(t,e){const i=t.x-e.x,s=t.y-e.y;return Math.sqrt(i*i+s*s)}calculateOpenness(t){const e=t[c.WRIST],r=([t[c.THUMB_TIP],t[c.INDEX_FINGER_TIP],t[c.MIDDLE_FINGER_TIP],t[c.RING_FINGER_TIP],t[c.PINKY_TIP]].reduce((o,a)=>o+this.distance3D(a,e),0)/5-.1)/.35;return Math.max(0,Math.min(1,r))}detectGesture(t,e,i){return this.isPinching(t)?f.PINCH:e.extendedCount===0&&i<.3?f.CLOSED_FIST:e.thumb&&!e.index&&!e.middle&&!e.ring&&!e.pinky?f.THUMBS_UP:!e.thumb&&e.index&&!e.middle&&!e.ring&&!e.pinky?f.POINTING:!e.thumb&&e.index&&e.middle&&!e.ring&&!e.pinky?f.PEACE:e.extendedCount>=4&&i>.5?f.OPEN_HAND:f.NONE}isPinching(t){const e=t[c.THUMB_TIP],i=t[c.INDEX_FINGER_TIP];return this.distance2D(e,i)<this._config.pinchThreshold}calculateGestureConfidence(t,e,i){switch(t){case f.CLOSED_FIST:return Math.min(1,(.3-i)/.3+(5-e.extendedCount)/5);case f.OPEN_HAND:return Math.min(1,i/.7+e.extendedCount/5);case f.POINTING:case f.THUMBS_UP:case f.PEACE:return e.extendedCount<=2?.9:.7;case f.PINCH:return .95;default:return .5}}smoothValue(t,e){return(1-this._config.smoothingFactor)*t+this._config.smoothingFactor*e}}class Ot{constructor(t){l(this,"name","DistanceController");l(this,"_config");l(this,"history",{lastMeasurements:null,smoothedMeasurements:null});this._config={...w.distance,...t}}get config(){return{...this._config}}updateConfig(t){this._config={...this._config,...t}}reset(){this.history={lastMeasurements:null,smoothedMeasurements:null}}process(t,e){const i=this.calculateMeasurements(t),s=this._config.smoothingEnabled&&this.history.smoothedMeasurements?this.smoothMeasurements(i,this.history.smoothedMeasurements):i;return this.history.lastMeasurements=i,this.history.smoothedMeasurements=s,{...e,custom:{...e.custom,distances:s}}}calculateMeasurements(t){const e=t.hands,i=this.calculateAverageHandSize(e.map(r=>r.landmarks)),s={palmToPalm:null,indexToIndex:null,thumbToThumb:null,primaryPinch:null,secondaryPinch:null,avgHandSize:i};if(e.length>=1){const r=e[0].landmarks;s.primaryPinch=this.calculatePinchDistance(r,i)}if(e.length>=2){const r=e[1].landmarks;s.secondaryPinch=this.calculatePinchDistance(r,i);const o=e[0].landmarks;s.palmToPalm=this.calculatePalmToPalmDistance(o,r,i),s.indexToIndex=this.calculateLandmarkDistance(o[c.INDEX_FINGER_TIP],r[c.INDEX_FINGER_TIP],i),s.thumbToThumb=this.calculateLandmarkDistance(o[c.THUMB_TIP],r[c.THUMB_TIP],i)}return s}calculatePinchDistance(t,e){const i=t[c.THUMB_TIP],s=t[c.INDEX_FINGER_TIP],r=this.distance2D(i,s);return this._config.normalizeToHandSize&&e>0?r/e:r}calculatePalmToPalmDistance(t,e,i){const s=this.calculatePalmCenter(t),r=this.calculatePalmCenter(e),o=this.distance2D(s,r);return this._config.normalizeToHandSize&&i>0?o/i:o}calculateLandmarkDistance(t,e,i){const s=this.distance2D(t,e);return this._config.normalizeToHandSize&&i>0?s/i:s}calculatePalmCenter(t){const e=[t[c.WRIST],t[c.INDEX_FINGER_MCP],t[c.MIDDLE_FINGER_MCP],t[c.RING_FINGER_MCP],t[c.PINKY_MCP]],i=e.reduce((s,r)=>({x:s.x+r.x,y:s.y+r.y,z:s.z+r.z}),{x:0,y:0,z:0});return{x:i.x/e.length,y:i.y/e.length,z:i.z/e.length}}calculateAverageHandSize(t){if(t.length===0)return .3;const e=t.map(i=>{const s=i[c.WRIST],r=i[c.MIDDLE_FINGER_TIP];return this.distance2D(s,r)});return e.reduce((i,s)=>i+s,0)/e.length}distance2D(t,e){const i=t.x-e.x,s=t.y-e.y;return Math.sqrt(i*i+s*s)}smoothMeasurements(t,e){const i=1-this._config.smoothingFactor,s=(r,o)=>r===null?null:o===null?r:i*r+this._config.smoothingFactor*o;return{palmToPalm:s(t.palmToPalm,e.palmToPalm),indexToIndex:s(t.indexToIndex,e.indexToIndex),thumbToThumb:s(t.thumbToThumb,e.thumbToThumb),primaryPinch:s(t.primaryPinch,e.primaryPinch),secondaryPinch:s(t.secondaryPinch,e.secondaryPinch),avgHandSize:i*t.avgHandSize+this._config.smoothingFactor*e.avgHandSize}}getMeasurements(){return this.history.smoothedMeasurements}}class Gt{constructor(t){l(this,"_config");l(this,"controllers");l(this,"positionController");l(this,"gestureController");l(this,"distanceController");l(this,"subscription",null);l(this,"stateSubject",new ft(M()));l(this,"lastTimestamp",0);this._config=this.mergeConfig(w,t),this.positionController=new St(this._config.position),this.gestureController=new Rt(this._config.gesture),this.distanceController=new Ot(this._config.distance),this.controllers=[this.positionController,this.gestureController,this.distanceController]}get state$(){return this.stateSubject.asObservable()}get config(){return{...this._config}}start(t){this.stop(),this.subscription=t.pipe(pt(e=>this.processFrame(e))).subscribe(e=>{this.stateSubject.next(e)})}stop(){this.subscription&&(this.subscription.unsubscribe(),this.subscription=null)}updateConfig(t){this._config=this.mergeConfig(this._config,t),t.position&&this.positionController.updateConfig(t.position),t.gesture&&this.gestureController.updateConfig(t.gesture),t.distance&&this.distanceController.updateConfig(t.distance)}getCurrentState(){return this.stateSubject.getValue()}reset(){this.controllers.forEach(t=>t.reset()),this.stateSubject.next(M()),this.lastTimestamp=0}processFrame(t){const e=this.lastTimestamp>0?t.timestamp-this.lastTimestamp:0;this.lastTimestamp=t.timestamp;let i=M();return i.timestamp=t.timestamp,i.deltaTime=e,i=this.positionController.process(t,i),i=this.gestureController.process(t,i),i=this.distanceController.process(t,i),i}mergeConfig(t,e){return e?{position:{...t.position,...e.position},gesture:{...t.gesture,...e.gesture},distance:{...t.distance,...e.distance}}:{...t}}getPositionController(){return this.positionController}getGestureController(){return this.gestureController}getDistanceController(){return this.distanceController}}class zt{constructor(){l(this,"state",{isInitialized:!1,isTracking:!1,error:null});l(this,"cameraPreview");l(this,"handTracker");l(this,"debugOverlay");l(this,"controllerManager");l(this,"statusEl",null);l(this,"startBtn",null);l(this,"stopBtn",null);l(this,"videoEl",null);l(this,"canvasEl",null);l(this,"fpsEl",null);l(this,"loadingOverlay",null);l(this,"loadingText",null);l(this,"progressFill",null);l(this,"gestureEl",null);this.cameraPreview=new Nt,this.handTracker=new wt,this.debugOverlay=new Ft,this.controllerManager=new Gt}initialize(){if(this.statusEl=document.getElementById("status"),this.startBtn=document.getElementById("startBtn"),this.stopBtn=document.getElementById("stopBtn"),this.videoEl=document.getElementById("webcam"),this.canvasEl=document.getElementById("overlay"),this.fpsEl=document.getElementById("fps"),this.loadingOverlay=document.getElementById("loadingOverlay"),this.loadingText=document.getElementById("loadingText"),this.progressFill=document.getElementById("progressFill"),this.gestureEl=document.getElementById("gesture"),!this.videoEl||!this.canvasEl){this.setError("Required DOM elements not found");return}this.setupEventListeners(),this.updateStatus("Ready - Click Start to begin"),this.state.isInitialized=!0}setupEventListeners(){var t,e;(t=this.startBtn)==null||t.addEventListener("click",()=>{this.start()}),(e=this.stopBtn)==null||e.addEventListener("click",()=>{this.stop()}),document.addEventListener("visibilitychange",()=>{document.hidden&&this.state.isTracking&&this.stop()})}showLoading(t,e=0){this.loadingOverlay&&this.loadingOverlay.classList.add("visible"),this.loadingText&&(this.loadingText.textContent=t),this.progressFill&&(this.progressFill.style.width=`${e}%`)}hideLoading(){this.loadingOverlay&&this.loadingOverlay.classList.remove("visible")}async start(){if(!(this.state.isTracking||!this.videoEl||!this.canvasEl))try{this.setButtonsEnabled(!1,!1),this.showLoading("Initializing camera...",10),this.updateStatus("Initializing camera..."),await this.cameraPreview.initialize(this.videoEl),this.showLoading("Camera ready",30);const{width:t,height:e}=this.cameraPreview.getDimensions();this.debugOverlay.setDimensions(t,e),this.debugOverlay.initialize(this.canvasEl,this.fpsEl??void 0),this.showLoading("Loading hand tracking model...",40),this.updateStatus("Loading hand tracking model..."),await this.handTracker.initialize(this.videoEl,(i,s)=>{this.showLoading(i,40+(s??0)*.5)}),this.showLoading("Starting tracking...",95),this.controllerManager.start(this.handTracker.hands$),this.controllerManager.state$.subscribe({next:i=>{this.updateControlStateDisplay(i)},error:i=>{console.error("Controller error:",i)}}),this.handTracker.hands$.subscribe({next:i=>{this.debugOverlay.draw(i)},error:i=>{console.error("Hand tracking error:",i),this.setError("Hand tracking error occurred")}}),this.handTracker.start(),this.state.isTracking=!0,this.hideLoading(),this.updateStatus("Tracking",!0),this.setButtonsEnabled(!1,!0)}catch(t){console.error("Failed to start:",t);const e=t instanceof Error?t.message:"Unknown error";this.hideLoading(),this.setError(e),this.setButtonsEnabled(!0,!1)}}stop(){this.state.isTracking&&(this.controllerManager.stop(),this.handTracker.stop(),this.cameraPreview.stop(),this.debugOverlay.clear(),this.state.isTracking=!1,this.updateStatus("Stopped"),this.setButtonsEnabled(!0,!1))}updateControlStateDisplay(t){if(this.gestureEl)if(t.primaryHand){const e=t.primaryHand.gesture.type,i=Math.round(t.primaryHand.gesture.confidence*100),s=Math.round(t.primaryHand.openness.value*100),r=t.primaryHand.fingers.extendedCount;this.gestureEl.textContent=`Gesture: ${e} (${i}%) | Openness: ${s}% | Fingers: ${r}`,this.gestureEl.style.display="block"}else this.gestureEl.textContent="No hand detected",this.gestureEl.style.display="block"}updateStatus(t,e=!1){this.statusEl&&(this.statusEl.textContent=t,this.statusEl.classList.toggle("tracking",e),this.statusEl.classList.toggle("error",!1))}setError(t){this.state.error=t,this.statusEl&&(this.statusEl.textContent=`Error: ${t}`,this.statusEl.classList.add("error"),this.statusEl.classList.remove("tracking"))}setButtonsEnabled(t,e){this.startBtn&&(this.startBtn.disabled=!t),this.stopBtn&&(this.stopBtn.disabled=!e)}dispose(){this.stop(),this.controllerManager.reset(),this.handTracker.dispose(),this.cameraPreview.dispose(),this.debugOverlay.dispose()}}const q=new zt;q.initialize();window.addEventListener("beforeunload",()=>{q.dispose()});
//# sourceMappingURL=index-1-wy8GH6.js.map
